package analyze_ipa

import (
	"archive/zip"
	"encoding/base64"
	"os"
	"regexp"
	"strings"
)

var (
	pngBody, _ = base64.RawStdEncoding.DecodeString(`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`)

	reInfoPlist = regexp.MustCompile(`Payload/[^/]+/Info\.plist`)
)

type AppInfo struct {
	Info            *PList
	IconBody        []byte
	MobileProvision []byte
	Size            int64
}

type PList struct {
	CFBundleName         string `plist:"CFBundleName"`
	CFBundleDisplayName  string `plist:"CFBundleDisplayName"`
	CFBundleVersion      string `plist:"CFBundleVersion"`
	CFBundleShortVersion string `plist:"CFBundleShortVersionString"`
	CFBundleIdentifier   string `plist:"CFBundleIdentifier"`
	MinimumOSVersion     string `plist:"MinimumOSVersion"`
}

func Parser(ipaPath string) (*AppInfo, error) {
	file, err := os.Open(ipaPath)
	if err != nil {
		return nil, err
	}
	defer file.Close()

	stat, err := file.Stat()
	if err != nil {
		return nil, err
	}
	reader, err := zip.NewReader(file, stat.Size())
	if err != nil {
		return nil, err
	}

	app := &AppInfo{
		Size: stat.Size(),
	}

	for _, f := range reader.File {
		if reInfoPlist.MatchString(f.Name) {
			if app.Info, err = parsePListFile(f); err != nil {
				return nil, err
			}
		}
		if strings.Contains(f.Name, "AppIcon60x60@3x.png") {
			if app.IconBody, err = parseIcon(f); err != nil {
				return nil, err
			}
		}
		if strings.Contains(f.Name, "embedded.mobileprovision") {
			if app.MobileProvision, err = parseMobileProvision(f); err != nil {
				return nil, err
			}
		}
		if app.Info != nil && app.IconBody != nil && app.MobileProvision != nil {
			break
		}
	}
	// 补偿默认图片
	if app.IconBody == nil {
		app.IconBody = pngBody
	}

	return app, nil
}
